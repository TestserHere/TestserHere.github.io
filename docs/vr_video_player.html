<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Draggable VR Video Player with Controls</title>

  <!-- Include A-Frame -->
  <script src="https://aframe.io/releases/latest/aframe.min.js"></script>

  <!-- Include Bootstrap and Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    /* Style for the draggable video container */
    #vr-container {
      position: absolute;
      cursor: move;
      top: 10%;
      left: 10%;
      z-index: 10;
    }

    /* Style for the controls at the top */
    #controls {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 20;
      display: flex;
      align-items: center;
      gap: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 5px;
    }

    /* Progress bar style */
    #progress-bar {
      width: 200px;
    }

    /* Volume control style */
    #volume-control {
      width: 100px;
    }

    /* File upload button style */
    #upload-button {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 1rem;
      padding: 0.5em;
      z-index: 20;
      background-color: #333;
      color: #fff;
      border: none;
      border-radius: 5px;
    }

    /* Hide the file input element */
    #file-upload {
      display: none;
    }

    /* Style for the play/pause button */
    #play-button {
      position: fixed;
      top: calc(50% - 1.25em);
      left: calc(50% - 1.25em);
      font-size: 2rem;
      width: 3em;
      height: 3em;
      z-index: 10;
      color: #fff;
      background-color: #333;
      border: none;
      border-radius: 50%;
      text-align: center;
    }
  </style>
</head>
<body>

  <!-- Play Button -->
  <button
    id="play-button"
    class="btn btn-dark"
  >
    <i class="bi bi-play-fill"></i>
  </button>

  <!-- File Upload Button -->
  <button id="upload-button" class="btn btn-dark">
    <i class="bi bi-upload"></i> Upload Video
  </button>
  <input type="file" id="file-upload" accept="video/*">

  <!-- Controls (Progress Bar, Pause/Resume, Volume Control) -->
  <div id="controls">
    <button id="pause-resume-button" class="btn btn-dark">
      <i class="bi bi-pause-fill"></i>
    </button>
    <input type="range" id="progress-bar" value="0" step="0.1" max="100" class="form-range">
    <input type="range" id="volume-control" value="1" step="0.01" max="1" class="form-range">
  </div>

  <!-- A-Frame VR Scene -->
  <a-scene id="vr-scene">
    <a-assets>
      <video
        id="vid"
        src="https://cdn.glitch.com/8935d2ed-c243-47e6-a74a-c275e93b7f20%2Fcity-4096-mp4-30fps-x264-ffmpeg.mp4?v=1580226185171"
        crossorigin="anonymous"
        autoplay="false"
        loop="true"
        style="display: none"
      ></video>
    </a-assets>

    <a-entity
      id="vr-video"
      geometry="primitive: sphere; radius: 5000; segmentsWidth: 64; segmentsHeight: 64;"
      material="shader: flat; src: #vid;"
      scale="-1 1 1"
    >
    </a-entity>
  </a-scene>

  <div id="vr-container">
    <!-- Here you could add controls for the VR scene if needed -->
  </div>

  <script>
    // Initialize the video element and buttons
    var vid = document.getElementById('vid');
    var playButton = document.getElementById('play-button');
    var pauseResumeButton = document.getElementById('pause-resume-button');
    var progressBar = document.getElementById('progress-bar');
    var volumeControl = document.getElementById('volume-control');
    var uploadButton = document.getElementById('upload-button');
    var fileInput = document.getElementById('file-upload');

    // Play the video when the button is clicked
    playButton.addEventListener("click", function(e) {
      this.style.display = 'none';  // Hide the play button
      vid.play();  // Play the video
      pauseResumeButton.innerHTML = '<i class="bi bi-pause-fill"></i>';
    }, false);

    // Pause/Resume the video when clicked
    pauseResumeButton.addEventListener("click", function() {
      if (vid.paused) {
        vid.play();
        this.innerHTML = '<i class="bi bi-pause-fill"></i>';
      } else {
        vid.pause();
        this.innerHTML = '<i class="bi bi-play-fill"></i>';
      }
    });

    // Trigger the file input when the upload button is clicked
    uploadButton.addEventListener("click", function() {
      fileInput.click();
    });

    // Handle the video upload and change the video source
    fileInput.addEventListener("change", function(event) {
      var file = event.target.files[0];
      if (file) {
        var videoUrl = URL.createObjectURL(file);
        vid.src = videoUrl;
        vid.play();
        playButton.style.display = 'none';
        pauseResumeButton.innerHTML = '<i class="bi bi-pause-fill"></i>';
      }
    });

    // Update the progress bar while the video is playing
    vid.addEventListener('timeupdate', function() {
      var value = (vid.currentTime / vid.duration) * 100;
      progressBar.value = value;
    });

    // Seek to a specific time when the progress bar is clicked
    progressBar.addEventListener('input', function() {
      var seekTime = (progressBar.value / 100) * vid.duration;
      vid.currentTime = seekTime;
    });

    // Update volume based on the volume control slider
    volumeControl.addEventListener('input', function() {
      vid.volume = volumeControl.value;
    });

    // Draggable functionality for the video container
    var dragElement = document.getElementById('vr-container');

    dragElement.onmousedown = function(e) {
      e.preventDefault();
      var offsetX = e.clientX - dragElement.getBoundingClientRect().left;
      var offsetY = e.clientY - dragElement.getBoundingClientRect().top;

      document.onmousemove = function(e) {
        dragElement.style.left = e.clientX - offsetX + 'px';
        dragElement.style.top = e.clientY - offsetY + 'px';
      };

      document.onmouseup = function() {
        document.onmousemove = null;
        document.onmouseup = null;
      };
    };
  </script>

</body>
</html>

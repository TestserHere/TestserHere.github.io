<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draggable VR Video Player with Controls</title>
    <script src="https://aframe.io/releases/latest/aframe.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        #vr-container {
            position: absolute;
            cursor: move;
            top: 10%;
            left: 10%;
            z-index: 10;
        }
        #controls {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
        #progress-bar {
            width: 200px;
        }
        #volume-control {
            width: 100px;
        }
        #upload-button {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 1rem;
            padding: 0.5em;
            z-index: 20;
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 5px;
        }
        #file-upload {
            display: none;
        }
        #play-button {
            position: fixed;
            top: calc(50% - 1.25em);
            left: calc(50% - 1.25em);
            font-size: 2rem;
            width: 3em;
            height: 3em;
            z-index: 10;
            color: #fff;
            background-color: #333;
            border: none;
            border-radius: 50%;
            text-align: center;
        }
    </style>
</head>
<body>
    <button id="play-button" class="btn btn-dark">
        <i class="bi bi-play-fill"></i>
    </button>
    <button id="upload-button" class="btn btn-dark">
        <i class="bi bi-upload"></i> Upload Video
    </button>
    <input type="file" id="file-upload" accept="video/*">
    <div id="controls">
        <button id="pause-resume-button" class="btn btn-dark">
            <i class="bi bi-pause-fill"></i>
        </button>
        <input type="range" id="progress-bar" value="0" step="0.1" max="100" class="form-range">
        <input type="range" id="volume-control" value="1" step="0.01" max="1" class="form-range">
    </div>
    <a-scene id="vr-scene">
        <a-assets>
            <video
                id="vid"
                src=""
                crossorigin="anonymous"
                autoplay="false"
                loop="true"
                style="display: none"
            ></video>
        </a-assets>
        <a-entity
            id="vr-video"
            geometry="primitive: sphere; radius: 5000; segmentsWidth: 64; segmentsHeight: 64;"
            material="shader: flat; src: #vid;"
            scale="-1 1 1"
        >
        </a-entity>
    </a-scene>
    <div id="vr-container">
    </div>
    <script>
        var vid = document.getElementById('vid');
        var playButton = document.getElementById('play-button');
        var pauseResumeButton = document.getElementById('pause-resume-button');
        var progressBar = document.getElementById('progress-bar');
        var volumeControl = document.getElementById('volume-control');
        var uploadButton = document.getElementById('upload-button');
        var fileInput = document.getElementById('file-upload');

        let duration = 0; // Store the video duration
        let metadataLoaded = false;
        let videoPlaying = false;


        function updateProgressBar() {
            if (metadataLoaded && duration > 0) {
                var value = (vid.currentTime / duration) * 100;
                progressBar.value = value;
            }
        }

        playButton.addEventListener("click", function(e) {
            this.style.display = 'none';
            if (!metadataLoaded) {
                vid.addEventListener('loadedmetadata', function() {
                    duration = vid.duration;
                    metadataLoaded = true;
                    videoPlaying = true;
                    updateProgressBar();
                    vid.play();
                });
             }else{
                vid.play();
                videoPlaying = true;
             }
            pauseResumeButton.innerHTML = '<i class="bi bi-pause-fill"></i>';
        }, false);

        pauseResumeButton.addEventListener("click", function() {
            if (videoPlaying) {
                vid.pause();
                this.innerHTML = '<i class="bi bi-play-fill"></i>';
                videoPlaying = false;
            } else {
                vid.play();
                this.innerHTML = '<i class="bi bi-pause-fill"></i>';
                videoPlaying = true;
            }
        });

        uploadButton.addEventListener("click", function() {
            fileInput.click();
        });

        fileInput.addEventListener("change", function(event) {
            var file = event.target.files[0];
            if (file) {
                var videoUrl = URL.createObjectURL(file);
                vid.src = videoUrl;
                metadataLoaded = false;
                videoPlaying = false;
                vid.addEventListener('loadedmetadata', function() {
                    duration = vid.duration;
                    metadataLoaded = true;
                    updateProgressBar();
                    vid.play();
                    videoPlaying = true;
                });
                playButton.style.display = 'none';
                pauseResumeButton.innerHTML = '<i class="bi bi-pause-fill"></i>';
            }
        });

        vid.addEventListener('timeupdate', function() {
            updateProgressBar();
        });

        progressBar.addEventListener('input', function() {
            if (metadataLoaded && duration > 0) {
                var seekTime = (progressBar.value / 100) * duration;
                vid.currentTime = seekTime;
            }
        });

        volumeControl.addEventListener('input', function() {
            vid.volume = volumeControl.value;
        });

        var dragElement = document.getElementById('vr-container');

        dragElement.onmousedown = function(e) {
            e.preventDefault();
            var offsetX = e.clientX - dragElement.getBoundingClientRect().left;
            var offsetY = e.clientY - dragElement.getBoundingClientRect().top;

            document.onmousemove = function(e) {
                dragElement.style.left = e.clientX - offsetX + 'px';
                dragElement.style.top = e.clientY - offsetY + 'px';
            };

            document.onmouseup = function() {
                document.onmousemove = null;
                document.onmouseup = null;
            };
        };

        vid.addEventListener('loadedmetadata', function() {
            progressBar.value = 0;
            duration = vid.duration;
            metadataLoaded = true;
        });
    </script>
</body>
</html>
